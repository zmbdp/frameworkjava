<!DOCTYPE HTML>
<html lang="zh">
<head>
<!-- Generated by javadoc (17) on Sun Jan 25 16:03:45 CST 2026 -->
<title>CaptchaService</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2026-01-25">
<meta name="description" content="declaration: package: com.zmbdp.common.message.service, class: CaptchaService">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="跳过导航链接">跳过导航链接</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="导航">
<li><a href="../../../../../index.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="nav-bar-cell1-rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../index-files/index-1.html">索引</a></li>
<li><a href="../../../../../help-doc.html#class">帮助</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li><a href="#field-summary">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">方法</a></li>
</ul>
<ul class="sub-nav-list">
<li>详细资料:&nbsp;</li>
<li><a href="#field-detail">字段</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">构造器</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">方法</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">程序包</span>&nbsp;<a href="package-summary.html">com.zmbdp.common.message.service</a></div>
<h1 title="类 CaptchaService" class="title">类 CaptchaService</h1>
</div>
<div class="inheritance" title="继承树"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="java.lang中的类或接口" class="external-link">java.lang.Object</a>
<div class="inheritance">com.zmbdp.common.message.service.CaptchaService</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations">@Service
@RefreshScope
</span><span class="modifiers">public class </span><span class="element-name type-name-label">CaptchaService</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="java.lang中的类或接口" class="external-link">Object</a></span></div>
<div class="block">验证码服务
 <p>
 提供验证码的生成、发送、存储、校验等功能。
 支持短信和邮件两种发送方式，根据账号格式自动选择发送器。
 <p>
 <b>核心功能：</b>
 <ul>
     <li>发送验证码：支持短信和邮件两种方式</li>
     <li>验证码存储：使用 Redis 存储验证码和发送次数</li>
     <li>发送限制：每日发送次数限制、频繁发送限制</li>
     <li>固定验证码：开发/测试环境可使用固定验证码，避免发送真实短信/邮件</li>
     <li>验证码校验：验证用户输入的验证码是否正确</li>
 </ul>
 <p>
 <b>使用示例：</b>

 <pre><code>
 // 发送验证码
 String code = captchaService.sendCode("13800138000");

 // 校验验证码
 boolean valid = captchaService.checkCode("13800138000", "123456");

 // 获取验证码（用于测试）
 String cachedCode = captchaService.getCode("13800138000");

 // 删除验证码
 captchaService.deleteCode("13800138000");
 </code></pre>
 <p>
 <b>配置说明：</b>
 <ul>
     <li>captcha.send-limit：每日发送次数限制（默认 50）</li>
     <li>captcha.code-expiration：验证码有效期，单位分钟（默认 5）</li>
     <li>captcha.send-message：是否发送验证码（默认 true）</li>
     <li>captcha.type：验证码类型（默认 2，数字+字母）</li>
     <li>sms.send-message：短信通道是否开启（默认 false）</li>
     <li>mail.send-message：邮件通道是否开启（默认 false）</li>
 </ul>
 <p>
 <b>注意事项：</b>
 <ul>
     <li>支持配置热更新（@RefreshScope）</li>
     <li>验证码存储在 Redis 中，有效期可配置</li>
     <li>发送次数限制按账号（手机号/邮箱）统计，每日重置</li>
     <li>频繁发送限制：1 分钟内只能发送一次</li>
     <li>如果使用固定验证码，发送失败不会抛出异常</li>
 </ul></div>
<dl class="notes">
<dt>作者:</dt>
<dd>稚名不带撇</dd>
<dt>另请参阅:</dt>
<dd>
<ul class="see-list">
<li><a href="../strategy/CaptchaSenderRouter.html" title="com.zmbdp.common.message.strategy中的类"><code>CaptchaSenderRouter</code></a></li>
<li><a href="../strategy/ICaptchaSenderStrategy.html" title="com.zmbdp.common.message.strategy中的接口"><code>ICaptchaSenderStrategy</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>字段概要</h2>
<div class="caption"><span>字段</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">修饰符和类型</div>
<div class="table-header col-second">字段</div>
<div class="table-header col-last">说明</div>
<div class="col-first even-row-color"><code>private <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Long.html" title="java.lang中的类或接口" class="external-link">Long</a></code></div>
<div class="col-second even-row-color"><code><a href="#accountCodeExpiration" class="member-name-link">accountCodeExpiration</a></code></div>
<div class="col-last even-row-color">
<div class="block">验证码的有效期，单位是分钟</div>
</div>
<div class="col-first odd-row-color"><code>private <a href="../strategy/CaptchaSenderRouter.html" title="com.zmbdp.common.message.strategy中的类">CaptchaSenderRouter</a></code></div>
<div class="col-second odd-row-color"><code><a href="#captchaSenderRouter" class="member-name-link">captchaSenderRouter</a></code></div>
<div class="col-last odd-row-color">
<div class="block">验证码发送器路由器</div>
</div>
<div class="col-first even-row-color"><code>private <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="java.lang中的类或接口" class="external-link">Integer</a></code></div>
<div class="col-second even-row-color"><code><a href="#captChaType" class="member-name-link">captChaType</a></code></div>
<div class="col-last even-row-color">
<div class="block">判断生成什么难度的验证码</div>
</div>
<div class="col-first odd-row-color"><code>private boolean</code></div>
<div class="col-second odd-row-color"><code><a href="#mailSendMessage" class="member-name-link">mailSendMessage</a></code></div>
<div class="col-last odd-row-color">
<div class="block">邮件服务是否发送邮件（EmailCodeServiceStrategy 的 sendMessage 配置）</div>
</div>
<div class="col-first even-row-color"><code>private <a href="../../redis/service/RedisService.html" title="com.zmbdp.common.redis.service中的类">RedisService</a></code></div>
<div class="col-second even-row-color"><code><a href="#redisService" class="member-name-link">redisService</a></code></div>
<div class="col-last even-row-color">
<div class="block">Redis 服务类</div>
</div>
<div class="col-first odd-row-color"><code>private <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="java.lang中的类或接口" class="external-link">Integer</a></code></div>
<div class="col-second odd-row-color"><code><a href="#sendLimit" class="member-name-link">sendLimit</a></code></div>
<div class="col-last odd-row-color">
<div class="block">单个手机号/邮箱，每日发送验证码次数的限制</div>
</div>
<div class="col-first even-row-color"><code>private boolean</code></div>
<div class="col-second even-row-color"><code><a href="#sendMessage" class="member-name-link">sendMessage</a></code></div>
<div class="col-last even-row-color">
<div class="block">验证码发送总开关</div>
</div>
<div class="col-first odd-row-color"><code>private boolean</code></div>
<div class="col-second odd-row-color"><code><a href="#smsSendMessage" class="member-name-link">smsSendMessage</a></code></div>
<div class="col-last odd-row-color">
<div class="block">短信服务是否发送线上短信</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>构造器概要</h2>
<div class="caption"><span>构造器</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">构造器</div>
<div class="table-header col-last">说明</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">CaptchaService</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>方法概要</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">所有方法</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">实例方法</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">具体方法</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">修饰符和类型</div>
<div class="table-header col-second">方法</div>
<div class="table-header col-last">说明</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#checkCode(java.lang.String,java.lang.String)" class="member-name-link">checkCode</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;code)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">校验手机号/邮箱与验证码是否匹配</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#deleteCode(java.lang.String)" class="member-name-link">deleteCode</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">从缓存中删除手机号/邮箱的验证码</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getCode(java.lang.String)" class="member-name-link">getCode</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">从缓存中获取手机号/邮箱的验证码</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#sendCode(java.lang.String)" class="member-name-link">sendCode</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">发送验证码</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>private boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldIgnoreSendFailure(java.lang.String)" class="member-name-link">shouldIgnoreSendFailure</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">判断发送失败时是否应该忽略异常</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>private boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#shouldUseFixedCode(java.lang.String)" class="member-name-link">shouldUseFixedCode</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">判断是否应该使用固定验证码</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">从类继承的方法&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="java.lang中的类或接口" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="java.lang中的类或接口" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="java.lang中的类或接口" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="java.lang中的类或接口" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="java.lang中的类或接口" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="java.lang中的类或接口" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="java.lang中的类或接口" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="java.lang中的类或接口" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="java.lang中的类或接口" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="java.lang中的类或接口" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="java.lang中的类或接口" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="java.lang中的类或接口" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>字段详细资料</h2>
<ul class="member-list">
<li>
<section class="detail" id="redisService">
<h3>redisService</h3>
<div class="member-signature"><span class="annotations">@Autowired
</span><span class="modifiers">private</span>&nbsp;<span class="return-type"><a href="../../redis/service/RedisService.html" title="com.zmbdp.common.redis.service中的类">RedisService</a></span>&nbsp;<span class="element-name">redisService</span></div>
<div class="block">Redis 服务类
 <p>
 用于存储验证码和发送次数限制。</div>
</section>
</li>
<li>
<section class="detail" id="sendLimit">
<h3>sendLimit</h3>
<div class="member-signature"><span class="annotations">@Value("${captcha.send-limit:50}")
</span><span class="modifiers">private</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="java.lang中的类或接口" class="external-link">Integer</a></span>&nbsp;<span class="element-name">sendLimit</span></div>
<div class="block">单个手机号/邮箱，每日发送验证码次数的限制
 <p>
 配置项：captcha.send-limit，默认值为 50。
 超过限制后，当日无法再发送验证码，需要等到次日重置。</div>
</section>
</li>
<li>
<section class="detail" id="accountCodeExpiration">
<h3>accountCodeExpiration</h3>
<div class="member-signature"><span class="annotations">@Value("${captcha.code-expiration:5}")
</span><span class="modifiers">private</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Long.html" title="java.lang中的类或接口" class="external-link">Long</a></span>&nbsp;<span class="element-name">accountCodeExpiration</span></div>
<div class="block">验证码的有效期，单位是分钟
 <p>
 配置项：captcha.code-expiration，默认值为 5 分钟。
 验证码过期后无法使用，需要重新发送。</div>
</section>
</li>
<li>
<section class="detail" id="sendMessage">
<h3>sendMessage</h3>
<div class="member-signature"><span class="annotations">@Value("${captcha.send-message:true}")
</span><span class="modifiers">private</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">sendMessage</span></div>
<div class="block">验证码发送总开关
 <p>
 配置项：captcha.send-message，默认值为 true。
 <ul>
     <li>true：发送验证码（根据通道配置决定发送短信或邮件）</li>
     <li>false：不发送验证码，使用固定验证码</li>
 </ul></div>
</section>
</li>
<li>
<section class="detail" id="captChaType">
<h3>captChaType</h3>
<div class="member-signature"><span class="annotations">@Value("${captcha.type:2}")
</span><span class="modifiers">private</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="java.lang中的类或接口" class="external-link">Integer</a></span>&nbsp;<span class="element-name">captChaType</span></div>
<div class="block">判断生成什么难度的验证码</div>
</section>
</li>
<li>
<section class="detail" id="smsSendMessage">
<h3>smsSendMessage</h3>
<div class="member-signature"><span class="annotations">@Value("${sms.send-message:false}")
</span><span class="modifiers">private</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">smsSendMessage</span></div>
<div class="block">短信服务是否发送线上短信
 <p>
 配置项：sms.send-message，默认值为 false。
 <ul>
     <li>true：发送真实短信（生产环境）</li>
     <li>false：不发送短信，使用固定验证码（开发/测试环境）</li>
 </ul>
 此配置对应 AliSmsServiceStrategy 的 sendMessage 配置。</div>
</section>
</li>
<li>
<section class="detail" id="mailSendMessage">
<h3>mailSendMessage</h3>
<div class="member-signature"><span class="annotations">@Value("${mail.send-message:false}")
</span><span class="modifiers">private</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">mailSendMessage</span></div>
<div class="block">邮件服务是否发送邮件（EmailCodeServiceStrategy 的 sendMessage 配置）</div>
</section>
</li>
<li>
<section class="detail" id="captchaSenderRouter">
<h3>captchaSenderRouter</h3>
<div class="member-signature"><span class="annotations">@Autowired
</span><span class="modifiers">private</span>&nbsp;<span class="return-type"><a href="../strategy/CaptchaSenderRouter.html" title="com.zmbdp.common.message.strategy中的类">CaptchaSenderRouter</a></span>&nbsp;<span class="element-name">captchaSenderRouter</span></div>
<div class="block">验证码发送器路由器
 <p>
 根据账号格式（手机号或邮箱）自动选择对应的发送器：
 <ul>
     <li>手机号：使用短信发送器（AliSmsServiceStrategy）</li>
     <li>邮箱：使用邮件发送器（EmailCodeServiceStrategy）</li>
 </ul></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>构造器详细资料</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>CaptchaService</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">CaptchaService</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>方法详细资料</h2>
<ul class="member-list">
<li>
<section class="detail" id="sendCode(java.lang.String)">
<h3>sendCode</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a></span>&nbsp;<span class="element-name">sendCode</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</span></div>
<div class="block">发送验证码
 <p>
 <b>限流说明：</b>
 <ul>
     <li>双维度限流（IP + 账号），任一维度超限即拒绝</li>
     <li>限流阈值：每分钟 3 次</li>
     <li>未登录时自动退化为 IP 限流</li>
     <li><b>内部调用行为：</b>
 <ul>
     <li>使用 AspectJ 切面，可以拦截内部调用（如 <code>this.sendCode()</code> 或 <code>captchaService.sendCode()</code>）</li>
     <li>但如果没有 HTTP 请求上下文（如定时任务、异步任务、单元测试），会跳过限流，直接放行</li>
     <li>只有通过 HTTP 请求调用（Controller -> Service）时，限流才会生效</li>
 </ul>
 </li>
 </ul></div>
<dl class="notes">
<dt>参数:</dt>
<dd><code>account</code> - 手机号 / 邮箱</dd>
<dt>返回:</dt>
<dd>验证码</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getCode(java.lang.String)">
<h3>getCode</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a></span>&nbsp;<span class="element-name">getCode</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</span></div>
<div class="block">从缓存中获取手机号/邮箱的验证码
 <p>
 从 Redis 中获取指定账号的验证码。适用于测试场景或验证码查询。
 <p>
 <b>使用示例：</b>
 <pre><code>
 // 获取验证码（用于测试）
 String code = captchaService.getCode("13800138000");
 if (code != null) {
     log.info("当前验证码: {}", code);
 } else {
     log.info("验证码不存在或已过期");
 }
 </code></pre>
 <p>
 <b>注意事项：</b>
 <ul>
     <li>如果验证码不存在或已过期，返回 null</li>
     <li>如果 account 为 null，可能抛出异常</li>
     <li>验证码存储在 Redis 中，有过期时间</li>
     <li>主要用于测试和调试场景</li>
 </ul></div>
<dl class="notes">
<dt>参数:</dt>
<dd><code>account</code> - 手机号或邮箱，不能为 null</dd>
<dt>返回:</dt>
<dd>验证码，如果不存在或已过期返回 null</dd>
<dt>另请参阅:</dt>
<dd>
<ul class="see-list-long">
<li><a href="#sendCode(java.lang.String)"><code>sendCode(String)</code></a></li>
<li><a href="#checkCode(java.lang.String,java.lang.String)"><code>checkCode(String, String)</code></a></li>
<li><a href="#deleteCode(java.lang.String)"><code>deleteCode(String)</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="deleteCode(java.lang.String)">
<h3>deleteCode</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">deleteCode</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</span></div>
<div class="block">从缓存中删除手机号/邮箱的验证码</div>
<dl class="notes">
<dt>参数:</dt>
<dd><code>account</code> - 手机号/邮箱</dd>
<dt>返回:</dt>
<dd>验证码</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="checkCode(java.lang.String,java.lang.String)">
<h3>checkCode</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">checkCode</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;code)</span></div>
<div class="block">校验手机号/邮箱与验证码是否匹配
 <p>
 验证用户输入的验证码是否正确。从 Redis 中获取存储的验证码，与用户输入的验证码进行比较。
 <p>
 <b>使用示例：</b>
 <pre><code>
 // 校验验证码
 boolean valid = captchaService.checkCode("13800138000", "123456");
 if (valid) {
     log.info("验证码正确");
     // 验证成功后删除验证码
     captchaService.deleteCode("13800138000");
 } else {
     log.warn("验证码错误");
 }
 </code></pre>
 <p>
 <b>注意事项：</b>
 <ul>
     <li>如果 account 或 code 为 null 或空字符串，抛出 ServiceException（ResultCode.INVALID_CODE）</li>
     <li>如果验证码不存在或已过期，抛出 ServiceException（ResultCode.INVALID_CODE）</li>
     <li>验证码比较区分大小写</li>
     <li>验证成功后建议立即删除验证码，防止重复使用</li>
     <li>验证码只能使用一次（验证成功后应删除）</li>
 </ul></div>
<dl class="notes">
<dt>参数:</dt>
<dd><code>account</code> - 手机号或邮箱，不能为 null 或空字符串</dd>
<dd><code>code</code> - 用户输入的验证码，不能为 null 或空字符串</dd>
<dt>返回:</dt>
<dd>true 表示验证码正确，false 表示验证码错误</dd>
<dt>抛出:</dt>
<dd><code><a href="../../domain/exception/ServiceException.html" title="com.zmbdp.common.domain.exception中的类">ServiceException</a></code> - 如果 account 或 code 为空，或验证码不存在</dd>
<dt>另请参阅:</dt>
<dd>
<ul class="see-list">
<li><a href="#sendCode(java.lang.String)"><code>sendCode(String)</code></a></li>
<li><a href="#getCode(java.lang.String)"><code>getCode(String)</code></a></li>
<li><a href="#deleteCode(java.lang.String)"><code>deleteCode(String)</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldUseFixedCode(java.lang.String)">
<h3>shouldUseFixedCode</h3>
<div class="member-signature"><span class="modifiers">private</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldUseFixedCode</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</span></div>
<div class="block">判断是否应该使用固定验证码
 <p>
 根据配置判断是否使用固定验证码。如果总开关关闭或对应通道关闭，则使用固定验证码。
 <p>
 <b>使用固定验证码的情况：</b>
 <ul>
     <li>sendMessage 为 false（总开关关闭）</li>
     <li>sendMessage 为 true，但手机号的 sms.send-message 为 false（短信通道关闭）</li>
     <li>sendMessage 为 true，但邮箱的 mail.send-message 为 false（邮件通道关闭）</li>
 </ul></div>
<dl class="notes">
<dt>参数:</dt>
<dd><code>account</code> - 账号（手机号或邮箱），不能为 null</dd>
<dt>返回:</dt>
<dd>true 表示使用固定验证码，false 表示生成随机验证码</dd>
<dt>另请参阅:</dt>
<dd>
<ul class="see-list-long">
<li><a href="#shouldIgnoreSendFailure(java.lang.String)"><code>shouldIgnoreSendFailure(String)</code></a></li>
<li><a href="../../domain/constants/MessageConstants.html#DEFAULT_CAPTCHA_CODE"><code>MessageConstants.DEFAULT_CAPTCHA_CODE</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="shouldIgnoreSendFailure(java.lang.String)">
<h3>shouldIgnoreSendFailure</h3>
<div class="member-signature"><span class="modifiers">private</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name">shouldIgnoreSendFailure</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="java.lang中的类或接口" class="external-link">String</a>&nbsp;account)</span></div>
<div class="block">判断发送失败时是否应该忽略异常
 <p>
 如果使用了固定验证码，则发送失败时应该忽略异常（因为验证码已经固定，用户可以直接使用）。
 此方法直接调用 <a href="#shouldUseFixedCode(java.lang.String)"><code>shouldUseFixedCode(String)</code></a> 方法。
 <p>
 <b>使用场景：</b>
 <ul>
     <li>在开发/测试环境使用固定验证码时，发送失败不影响功能</li>
     <li>在生产环境使用随机验证码时，发送失败必须抛出异常</li>
 </ul>
 <p>
 <b>注意事项：</b>
 <ul>
     <li>如果使用固定验证码，返回 true（忽略发送失败）</li>
     <li>如果使用随机验证码，返回 false（发送失败时抛出异常）</li>
     <li>此方法用于 sendCode 方法中的异常处理逻辑</li>
 </ul></div>
<dl class="notes">
<dt>参数:</dt>
<dd><code>account</code> - 账号（手机号或邮箱），不能为 null</dd>
<dt>返回:</dt>
<dd>true 表示忽略发送失败，false 表示发送失败时抛出异常</dd>
<dt>另请参阅:</dt>
<dd>
<ul class="see-list">
<li><a href="#shouldUseFixedCode(java.lang.String)"><code>shouldUseFixedCode(String)</code></a></li>
<li><a href="#sendCode(java.lang.String)"><code>sendCode(String)</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
